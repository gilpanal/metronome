(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function s(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(t){if(t.ep)return;t.ep=!0;const a=s(t);fetch(t.href,a)}})();class u{constructor(){this.audioContext=null,this.notesInQueue=[],this.currentBeatInBar=0,this.beatsPerBar=4,this.noteDuration=4,this.tempo=120,this.lookahead=25,this.scheduleAheadTime=.1,this.nextNoteTime=0,this.isRunning=!1,this.timerWorker=null,this.activate=!1,this.callback_start=null,this.callback_stop=null,this.prevBeatBar=4}init(){this.timerWorker=new Worker(new URL("/metronome/assets/metronomeworker-BpdqdNDL.js",import.meta.url),{type:"module"}),this.timerWorker.onmessage=n=>{n.data==="tick"&&this.scheduler()},this.timerWorker.postMessage({interval:this.lookahead})}nextNote(){const n=60/this.tempo*(4/this.noteDuration);this.nextNoteTime+=n,this.currentBeatInBar++,(this.currentBeatInBar===this.beatsPerBar||this.prevBeatBar!==this.beatsPerBar)&&(this.currentBeatInBar=0,this.prevBeatBar=this.beatsPerBar)}scheduleNote(n,s){this.notesInQueue.push({note:n,time:s});const i=this.audioContext.createOscillator(),t=this.audioContext.createGain();i.frequency.value=n===0?1e3:800,t.gain.value=1,t.gain.exponentialRampToValueAtTime(1,s+.001),t.gain.exponentialRampToValueAtTime(.001,s+.02),i.connect(t),t.connect(this.audioContext.destination),i.start(s),i.stop(s+.03)}scheduler(){for(;this.nextNoteTime<this.audioContext.currentTime+this.scheduleAheadTime;)this.scheduleNote(this.currentBeatInBar,this.nextNoteTime),this.nextNote()}start(n=0){if(this.isRunning)return;this.audioContext===null&&(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.isRunning=!0;const s=60/this.tempo*(4/this.noteDuration),i=Math.floor(n/s),t=n%(s*this.beatsPerBar);this.currentBeatInBar=i%this.beatsPerBar,this.nextNoteTime=this.audioContext.currentTime+.05-t,this.timerWorker.postMessage("start"),this.callback_start&&this.callback_start()}stop(){this.isRunning=!1,this.timerWorker.postMessage("stop"),this.callback_stop&&this.callback_stop()}startStop(n=0){this.isRunning?this.stop():this.start(n)}}let e=null;const m=()=>{const o=document.getElementById("tempo");o.textContent=e.tempo;const n=document.querySelectorAll("[data-id='tempo-change']");for(let s=0;s<n.length;s++)n[s].addEventListener("click",function(){const i=parseInt(this.dataset.change),t=e.tempo+i;t>=5&&t<=500&&(e.tempo=t,o.textContent=e.tempo,r())})},d=()=>{const o=document.getElementById("beatsperbar");o.textContent=e.beatsPerBar;const n=document.querySelectorAll("[data-id='beatsperbar-change']");for(let s=0;s<n.length;s++)n[s].addEventListener("click",function(){const i=parseInt(this.dataset.change),t=e.beatsPerBar+i;t>=1&&t<=50&&(e.beatsPerBar=t,o.textContent=e.beatsPerBar,document.getElementById("topnumbersignature").textContent=e.beatsPerBar,r())})},l={1:"",2:"",4:"",8:"",16:""},h=()=>{const o=document.getElementById("notedurationselectable");o.onchange=()=>{e.noteDuration=o.value,document.getElementById("bottomnumbersignature").textContent=o.value,document.getElementById("noteMusicSymbol").textContent=l[o.value],r()}},r=()=>{if(e.isRunning){const n=60/e.tempo*(4/e.noteDuration),s=document.getElementById("metronome-fonticon");s.style.animation=`blink ${n}s infinite`}},p=()=>{document.getElementById("metronome-fonticon").classList.remove("text-success"),document.getElementById("metronome-fonticon").classList.add("text-warning"),r()},g=()=>{document.getElementById("metronome-fonticon").classList.remove("text-warning"),e.activate&&document.getElementById("metronome-fonticon").classList.add("text-success");const o=document.getElementById("metronome-fonticon");o.style.animation="none"},B=()=>{const o=document.getElementById("play-pause-icon");e.startStop(),e.isRunning?o.className="pause-metronome-icon":o.className="play-metronome-icon"},f=()=>{e.activate=!e.activate,e.activate?document.getElementById("metronome-fonticon").classList.add("text-success"):document.getElementById("metronome-fonticon").classList.remove("text-success")},b=()=>{e||(e=new u,e.init(),e.callback_start=p,e.callback_stop=g);const o=document.getElementById("metronomeSwitch");o.checked=e.activate,document.getElementById("play-button").onclick=B,m(),d(),h(),o.onclick=f,document.getElementById("topnumbersignature").textContent=e.beatsPerBar,document.getElementById("bottomnumbersignature").textContent=e.noteDuration,document.getElementById("notedurationselectable").value=e.noteDuration,document.getElementById("noteMusicSymbol").textContent=l[e.noteDuration]};b();
